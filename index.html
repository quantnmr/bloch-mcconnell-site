<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloch-McConnell Exchange NMR Simulation</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>The Bloch-McConnell Equations and Exchange Phenomenon</h1>
            <p>Interactive simulation of two-state chemical exchange in NMR spectroscopy</p>
        </div>

        <div class="tab-bar">
            <button class="tab-button active" data-tab="bloch">Bloch Equations</button>
            <button class="tab-button" data-tab="simulation">Bloch-McConnell Model</button>
            <button class="tab-button" data-tab="animation">Spin Exchange and CPMG Demonstration</button>
            <button class="tab-button" data-tab="dispersion">CPMG Relaxation Dispersion</button>
        </div>

        <div class="tab-content active" id="tab-bloch">
            <div class="content">
                <div class="controls-panel">
                    <h2>The Bloch Equations</h2>

                    <div class="bloch-equations">
                        <p class="eq-intro">The Bloch equations describe the time evolution of nuclear magnetization <b>M</b> = (M<sub>x</sub>, M<sub>y</sub>, M<sub>z</sub>) in the rotating frame. During free precession (after an RF pulse), with no applied RF field:</p>

                        <div class="eq-section-title">Differential Equations</div>
                        <div class="eq-line">dM<sub>x</sub>/dt = 2&pi;&thinsp;&Delta;&Omega;&thinsp;M<sub>y</sub> &minus; R<sub>2</sub>&thinsp;M<sub>x</sub></div>
                        <div class="eq-line">dM<sub>y</sub>/dt = &minus;2&pi;&thinsp;&Delta;&Omega;&thinsp;M<sub>x</sub> &minus; R<sub>2</sub>&thinsp;M<sub>y</sub></div>
                        <div class="eq-line">dM<sub>z</sub>/dt = &minus;R<sub>1</sub>(M<sub>z</sub> &minus; M<sub>0</sub>)</div>

                        <div class="eq-section-title">Analytical Solution</div>
                        <p class="eq-note">After a pulse of flip angle &alpha;, the transverse magnetization is:</p>
                        <div class="eq-line">M<sub>x</sub>(t) + <i>i</i>&thinsp;M<sub>y</sub>(t) = M<sub>0</sub>&thinsp;sin(&alpha;)&thinsp;e<sup><i>i</i>&thinsp;2&pi;&thinsp;&Delta;&Omega;&thinsp;t</sup>&thinsp;e<sup>&minus;R<sub>2</sub>&thinsp;t</sup></div>
                        <p class="eq-note">This is the <b>Free Induction Decay</b> (FID) &mdash; a sinusoid at the offset frequency &Delta;&Omega;, decaying with time constant T<sub>2</sub> = 1/R<sub>2</sub>.</p>

                        <div class="eq-section-title">NMR Spectrum</div>
                        <p class="eq-note">The Fourier transform of the FID gives a <b>Lorentzian</b> peak centred at &Delta;&Omega; with full width at half maximum:</p>
                        <div class="eq-line">FWHM = R<sub>2</sub> / &pi;</div>
                    </div>

                    <h2 style="margin-top: 18px;">Controls</h2>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">R<sub>2</sub></span> = <span class="value" id="bloch-R2-value">25.0</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Transverse Relaxation</span>
                        </div>
                        <input type="range" id="bloch-R2" class="slider" min="-1" max="3" step="0.01" value="1.40">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">R<sub>1</sub></span> = <span class="value" id="bloch-R1-value">10.0</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Longitudinal Relaxation</span>
                        </div>
                        <input type="range" id="bloch-R1" class="slider" min="-2" max="2" step="0.01" value="1">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">&Delta;&Omega;</span> = <span class="value" id="bloch-delta-value">100</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Offset Frequency</span>
                        </div>
                        <input type="range" id="bloch-delta" class="slider" min="-100" max="100" step="1" value="100">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Flip angle <span class="math">&alpha;</span> = <span class="value" id="bloch-flip-value">90</span>&deg;</span>
                            <span style="color: #888; font-size: 0.9em;">Excitation Pulse</span>
                        </div>
                        <input type="range" id="bloch-flip" class="slider" min="1" max="180" step="1" value="90">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Animation speed = <span class="value" id="bloch-speed-value">0.0200</span>&times;</span>
                            <span style="color: #888; font-size: 0.9em;">Magnetization Vector</span>
                        </div>
                        <input type="range" id="bloch-speed" class="slider" min="-4" max="0" step="0.01" value="-1.70">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">I<sub>min</sub></span> = <span class="value" id="bloch-ftMin-value">-2.0</span></span>
                            <span style="color: #888; font-size: 0.9em;">Intensity Min</span>
                        </div>
                        <input type="range" id="bloch-ftMin" class="slider" min="-20" max="0" step="0.1" value="-2">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">I<sub>max</sub></span> = <span class="value" id="bloch-ftMax-value">50.0</span></span>
                            <span style="color: #888; font-size: 0.9em;">Intensity Max</span>
                        </div>
                        <input type="range" id="bloch-ftMax" class="slider" min="1" max="200" step="0.1" value="50">
                    </div>

                    <div class="control-group">
                        <label class="checkbox-group">
                            <input type="checkbox" id="bloch-d1-enabled">
                            <span>D1 simulation</span>
                        </label>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>D1 = <span class="value" id="bloch-d1-value">1.00</span> s</span>
                            <span style="color: #888; font-size: 0.9em;">Recycle Delay</span>
                        </div>
                        <input type="range" id="bloch-d1" class="slider" min="0.05" max="3.0" step="0.01" value="1.0">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Ernst Angle = <span class="value" id="bloch-ernst-value">0</span>&deg;</span>
                            <span style="color: #888; font-size: 0.9em;">Based on D1 and T1</span>
                        </div>
                    </div>
                </div>

                <div class="visualization-panel">
                    <div class="chart-container">
                        <div class="chart-title">Magnetization Vector</div>
                        <div id="bloch-vector-plot"></div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">NMR Spectrum</div>
                        <div id="bloch-spectrum-plot"></div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Free Induction Decay (FID)</div>
                        <div id="bloch-fid-plot"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-simulation">
            <div class="content">
                <div class="controls-panel">
                    <h2>The Bloch-McConnell Equations</h2>

                    <div class="bloch-equations">
                        <p class="eq-intro">The Bloch-McConnell equations extend the Bloch equations to include chemical exchange between two states A&thinsp;&#8652;&thinsp;B. The transverse magnetization of each state evolves under precession, relaxation, <em>and</em> exchange:</p>

                        <div class="eq-section-title">Coupled Differential Equations</div>
                        <div class="eq-line">dM<sup>+</sup><sub>A</sub>/dt = (<i>i</i>&thinsp;2&pi;&thinsp;&Delta;&Omega;<sub>A</sub> &minus; R<sub>2,A</sub> &minus; k<sub>AB</sub>)&thinsp;M<sup>+</sup><sub>A</sub> + k<sub>BA</sub>&thinsp;M<sup>+</sup><sub>B</sub></div>
                        <div class="eq-line">dM<sup>+</sup><sub>B</sub>/dt = k<sub>AB</sub>&thinsp;M<sup>+</sup><sub>A</sub> + (<i>i</i>&thinsp;2&pi;&thinsp;&Delta;&Omega;<sub>B</sub> &minus; R<sub>2,B</sub> &minus; k<sub>BA</sub>)&thinsp;M<sup>+</sup><sub>B</sub></div>

                        <div class="eq-section-title">Matrix Form</div>
                        <p class="eq-note">This can be written as d<b>M</b>/dt = <b>L</b>&thinsp;<b>M</b>, where:</p>
                        <div class="eq-matrix">
                            <span class="eq-matrix-label"><b>L</b> = </span>
                            <span class="eq-matrix-bracket">(</span>
                            <table class="eq-matrix-table">
                                <tr>
                                    <td><i>i</i>&thinsp;2&pi;&thinsp;&Delta;&Omega;<sub>A</sub> &minus; R<sub>2,A</sub> &minus; k<sub>AB</sub></td>
                                    <td>k<sub>BA</sub></td>
                                </tr>
                                <tr>
                                    <td>k<sub>AB</sub></td>
                                    <td><i>i</i>&thinsp;2&pi;&thinsp;&Delta;&Omega;<sub>B</sub> &minus; R<sub>2,B</sub> &minus; k<sub>BA</sub></td>
                                </tr>
                            </table>
                            <span class="eq-matrix-bracket">)</span>
                        </div>

                        <div class="eq-section-title">Solution</div>
                        <div class="eq-line"><b>M</b>(t) = e<sup><b>L</b>t</sup>&thinsp;<b>M</b>(0)</div>
                        <p class="eq-note">The FID is the sum M<sup>+</sup><sub>A</sub>(t) + M<sup>+</sup><sub>B</sub>(t), weighted by equilibrium populations p<sub>A</sub> = k<sub>BA</sub>/k<sub>ex</sub> and p<sub>B</sub> = k<sub>AB</sub>/k<sub>ex</sub>.</p>
                    </div>

                    <h2 style="margin-top: 14px;">Controls</h2>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">k<sub>AB</sub></span> = <span class="value" id="kAB-value">1.00</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Exchange Rate A→B</span>
                        </div>
                        <input type="range" id="kAB" class="slider" min="-1" max="6" step="0.01" value="0">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">k<sub>BA</sub></span> = <span class="value" id="kBA-value">1.00</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Exchange Rate B→A</span>
                        </div>
                        <input type="range" id="kBA" class="slider" min="-1" max="6" step="0.01" value="0">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">R<sub>2,A</sub></span> = <span class="value" id="R2A-value">50.12</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Transverse Relaxation A</span>
                        </div>
                        <input type="range" id="R2A" class="slider" min="-1" max="3" step="0.01" value="1.7">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">R<sub>2,B</sub></span> = <span class="value" id="R2B-value">50.12</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Transverse Relaxation B</span>
                        </div>
                        <input type="range" id="R2B" class="slider" min="-1" max="3" step="0.01" value="1.7">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">ΔΩ<sub>A</sub></span> = <span class="value" id="deltaA-value">-400</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Chemical Shift A</span>
                        </div>
                        <input type="range" id="deltaA" class="slider" min="-1000" max="1000" step="1" value="-400">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">ΔΩ<sub>B</sub></span> = <span class="value" id="deltaB-value">500</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Chemical Shift B</span>
                        </div>
                        <input type="range" id="deltaB" class="slider" min="-1000" max="1000" step="1" value="500">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">I<sub>min</sub></span> = <span class="value" id="ftMin-value">-2.0</span></span>
                            <span style="color: #888; font-size: 0.9em;">Intensity Min</span>
                        </div>
                        <input type="range" id="ftMin" class="slider" min="-20" max="0" step="0.1" value="-2">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">I<sub>max</sub></span> = <span class="value" id="ftMax-value">50.0</span></span>
                            <span style="color: #888; font-size: 0.9em;">Intensity Max</span>
                        </div>
                        <input type="range" id="ftMax" class="slider" min="1" max="200" step="0.1" value="50">
                    </div>

                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="equalK">
                            <label for="equalK">Set <span class="math">k<sub>BA</sub> = k<sub>AB</sub></span></label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="lockRatio">
                            <label for="lockRatio">Lock ratio <span class="math">k<sub>BA</sub>/k<sub>AB</sub></span></label>
                        </div>
                    </div>
                </div>

                <div class="visualization-panel">
                    <div class="chart-container">
                        <div class="chart-title">NMR Spectrum</div>
                        <div id="spectrum-plot"></div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Free Induction Decay (FID)</div>
                        <div id="fid-plot"></div>
                    </div>

                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-animation">
            <div class="animation-container">
                <div class="animation-controls">
                    <h2>Animation Controls</h2>
                    <div class="control-group">
                        <div class="view-toggle">
                            <button id="view-concentric" class="view-btn active">Concentric</button>
                            <button id="view-vector" class="view-btn">Vector</button>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Number of Spins = <span class="value" id="anim-circles-value">50</span></span>
                        </div>
                        <input type="range" id="anim-circles" class="slider" min="2" max="500" step="2" value="50">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Rate A = <span class="value" id="anim-rate-value">0.25</span> Hz</span>
                        </div>
                        <input type="range" id="anim-rate" class="slider" min="0.01" max="4" step="0.01" value="0.25">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Rate B = <span class="value" id="anim-rate2-value">0.25</span> Hz</span>
                        </div>
                        <input type="range" id="anim-rate2" class="slider" min="0.01" max="4" step="0.01" value="0.25">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Exchange Rate = <span class="value" id="anim-exchange-value">0.0</span> Hz</span>
                        </div>
                        <input type="range" id="anim-exchange" class="slider" min="0" max="20" step="0.1" value="0">
                    </div>
                    <div id="anim-single-echo-controls" class="control-group" style="display: none;">
                        <div class="control-label">
                            <span>τ = <span class="value" id="anim-tau-value">1.0</span> s</span>
                            <span style="color: #888; font-size: 0.9em;">Echo delay</span>
                        </div>
                        <input type="range" id="anim-tau" class="slider" min="0.1" max="2" step="0.1" value="1">
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="anim-single-echo">
                            <label for="anim-single-echo">Single Spin Echo (τ – 2τ – τ)</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">ν<sub>CPMG</sub></span> = <span class="value" id="anim-echo-rate-value">0</span> Hz</span>
                            <span style="color: #888; font-size: 0.9em;">Echo Rate</span>
                        </div>
                        <input type="range" id="anim-echo-rate" class="slider" min="0" max="200" step="1" value="0">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Number of Echoes = <span class="value" id="anim-num-echoes-value">4</span></span>
                            <span style="color: #888; font-size: 0.9em;">(always even)</span>
                        </div>
                        <input type="range" id="anim-num-echoes" class="slider" min="2" max="2000" step="2" value="4">
                    </div>
                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="anim-cpmg-lock">
                            <label for="anim-cpmg-lock">CPMG Dispersion (fixed T = 10 s)</label>
                        </div>
                    </div>
                    <button id="anim-play" class="anim-button">Play</button>
                </div>
                <div class="animation-right">
                    <div class="animation-plots">
                        <div class="animation-plot-wrapper">
                            <div id="animation-plot"></div>
                        </div>
                        <div class="signal-plot-wrapper">
                            <div id="signal-plot"></div>
                        </div>
                    </div>
                    <div class="mx-plot-wrapper">
                        <div id="mx-plot"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-dispersion">
            <div class="dispersion-container">
                <div class="dispersion-controls">
                    <h2>CPMG Relaxation Dispersion</h2>

                    <div class="bloch-equations">
                        <p class="eq-intro">CPMG experiments measure R<sub>2,eff</sub> as a function of the refocusing pulse rate &nu;<sub>CPMG</sub>. Exchange broadening is progressively quenched at higher &nu;<sub>CPMG</sub>, producing dispersion curves that encode the exchange dynamics.</p>

                        <div class="eq-section-title">Luz-Meiboom (LM) &mdash; fast-limit</div>
                        <p class="eq-note">Valid when k<sub>ex</sub> &Gt; |&Delta;&omega;|:</p>
                        <div class="eq-line">R<sub>2,eff</sub> = R<sub>2</sub><sup>0</sup> + &Phi;<sub>ex</sub>/k<sub>ex</sub> &middot; (1 &minus; tanh(k<sub>ex</sub>/4&nu;<sub>CPMG</sub>) / (k<sub>ex</sub>/4&nu;<sub>CPMG</sub>))</div>
                        <p class="eq-note">where &Phi;<sub>ex</sub> = p<sub>A</sub>&thinsp;p<sub>B</sub>&thinsp;&Delta;&omega;&sup2; and R<sub>ex</sub> = &Phi;<sub>ex</sub>/k<sub>ex</sub>.</p>

                        <div class="eq-section-title">Carver-Richards (CR) &mdash; exact two-site</div>
                        <div class="eq-line">R<sub>2,eff</sub> = &frac12;(R<sub>2,A</sub><sup>0</sup> + R<sub>2,B</sub><sup>0</sup> + k<sub>ex</sub> &minus; 2&nu;<sub>CPMG</sub>&thinsp;acosh(D<sub>+</sub>&thinsp;cosh&thinsp;&eta;<sub>+</sub> &minus; D<sub>&minus;</sub>&thinsp;cos&thinsp;&eta;<sub>&minus;</sub>))</div>
                        <p class="eq-note">where &tau;<sub>cp</sub> = 1/(2&nu;<sub>CPMG</sub>) and:</p>
                        <div class="eq-line eq-small">D<sub>&plusmn;</sub> = &frac12;(&plusmn;1 + (&psi; + 2&Delta;&omega;&sup2;) / &radic;(&psi;&sup2; + &xi;&sup2;))</div>
                        <div class="eq-line eq-small">&eta;<sub>&plusmn;</sub> = &tau;<sub>cp</sub>/&radic;2 &middot; &radic;(&plusmn;&psi; + &radic;(&psi;&sup2; + &xi;&sup2;))</div>
                        <div class="eq-line eq-small">&psi; = (R<sub>2,A</sub><sup>0</sup> &minus; R<sub>2,B</sub><sup>0</sup> + (p<sub>B</sub>&minus;p<sub>A</sub>)k<sub>ex</sub>)&sup2; &minus; &Delta;&omega;&sup2; + 4p<sub>A</sub>p<sub>B</sub>k<sub>ex</sub>&sup2;</div>
                        <div class="eq-line eq-small">&xi; = 2&Delta;&omega;(R<sub>2,A</sub><sup>0</sup> &minus; R<sub>2,B</sub><sup>0</sup> + (p<sub>B</sub>&minus;p<sub>A</sub>)k<sub>ex</sub>)</div>
                    </div>

                    <h2 style="margin-top: 14px;">Parameters</h2>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">k<sub>ex</sub></span> = <span class="value" id="disp-kex-value">1500</span> s⁻¹</span>
                            <span style="color: #888; font-size: 0.9em;">Exchange Rate</span>
                        </div>
                        <input type="range" id="disp-kex" class="slider" min="1.7" max="4.7" step="0.01" value="3.176">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">p<sub>B</sub></span> = <span class="value" id="disp-pB-value">5.0</span>%</span>
                            <span style="color: #888; font-size: 0.9em;">Minor State Population</span>
                        </div>
                        <input type="range" id="disp-pB" class="slider" min="0.5" max="50" step="0.1" value="5">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Nucleus:
                                <select id="disp-nucleus" style="font-size: 0.95em; padding: 2px 4px; border-radius: 4px; border: 1px solid #ccc;">
                                    <option value="15N" selected>¹⁵N</option>
                                    <option value="13C">¹³C</option>
                                    <option value="1H">¹H</option>
                                </select>
                            </span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">|Δδ|</span> = <span class="value" id="disp-dw-value">3.29</span> ppm</span>
                            <span style="color: #888; font-size: 0.9em;">Chemical Shift Difference</span>
                        </div>
                        <input type="range" id="disp-dw" class="slider" min="0.1" max="16.5" step="0.01" value="3.29">
                        <div style="color: #888; font-size: 0.85em; margin-top: 4px;">
                            |Δν| at 14.1 T = <span class="value" id="disp-dw-hz600">200</span> Hz
                            &nbsp;|&nbsp;
                            |Δν| at 18.8 T = <span class="value" id="disp-dw-hz800">267</span> Hz
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span><span class="math">R<sub>2</sub><sup>0</sup></span> (14.1 T) = <span class="value" id="disp-R20-value">20.0</span> s⁻¹</span>
                            <span style="color: #888; font-size: 0.9em;">Intrinsic Relaxation</span>
                        </div>
                        <input type="range" id="disp-R20" class="slider" min="0" max="2" step="0.01" value="1.30">
                    </div>

                    <div class="control-group" id="disp-R20-800-group" style="display: none;">
                        <div class="control-label">
                            <span><span class="math">R<sub>2</sub><sup>0</sup></span> (18.8 T) = <span class="value" id="disp-R20-800-value">25.0</span> s⁻¹</span>
                            <span style="color: #888; font-size: 0.9em;">Intrinsic Relaxation (18.8 T)</span>
                        </div>
                        <input type="range" id="disp-R20-800" class="slider" min="0" max="2" step="0.01" value="1.40">
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Noise σ = <span class="value" id="disp-noise-value">0.5</span> s⁻¹</span>
                            <span style="color: #888; font-size: 0.9em;">Simulated Noise</span>
                        </div>
                        <input type="range" id="disp-noise" class="slider" min="0" max="5" step="0.1" value="0.5">
                    </div>

                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="disp-dual-field">
                            <label for="disp-dual-field">Show 18.8 T (800 MHz) field</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="disp-show-fast" checked>
                            <label for="disp-show-fast">Show Luz-Meiboom (LM) fast-limit approximation</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="disp-ecpmg">
                            <label for="disp-ecpmg">eCPMG range (0–30,000 Hz)</label>
                        </div>
                    </div>

                    <div class="preset-buttons">
                        <button class="preset-btn" id="preset-fast">Fast</button>
                        <button class="preset-btn" id="preset-intermediate">Intermediate</button>
                        <button class="preset-btn" id="preset-slow">Slow</button>
                        <button class="preset-btn" id="preset-no-exchange">No Exchange</button>
                    </div>

                    <button class="anim-button" id="disp-resample" style="margin-top: 8px;">Resample Noise</button>

                    <div class="regime-indicator" id="regime-indicator">
                        <div><span class="math">k<sub>ex</sub></span> / |Δω| = <span class="value" id="disp-ratio-value">1.19</span></div>
                        <div>Regime: <strong id="disp-regime-label">Intermediate</strong></div>
                        <div><span class="math">R<sub>ex</sub></span> ≈ <span class="value" id="disp-Rex-value">50.0</span> s⁻¹ <span style="color: #888; font-size: 0.85em;">(LM fast limit)</span></div>
                    </div>
                </div>

                <div class="dispersion-right">
                    <div class="chart-container">
                        <div class="chart-title">CPMG Relaxation Dispersion Profile</div>
                        <div id="dispersion-plot"></div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Exchange-Broadened NMR Spectrum</div>
                        <div id="dispersion-spectrum-plot"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>